<div class="page-container">
  <div id="container-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="card-title mb-0">Meus Orçamentos</span>
    </div>

    <div class="card p-4">
      <div class="table-responsive">
        <table class="table table-dark table-striped table-hover align-middle">
          <thead>
            <tr>
              <th scope="col" style="width: 5%;"></th>
              <th scope="col">ID</th>
              <th scope="col">Destino ID</th>
              <th scope="col">Valor Total</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let o of orcamentos">
              <tr class="orcamento-row">
                <td>
                  <button
                    class="btn btn-sm btn-outline-secondary"
                    (click)="toggleContas(o)"
                    aria-label="Mostrar detalhes"
                  >
                    <i
                      class="fas"
                      [ngClass]="{
                        'fa-chevron-down': orcamentoExpandido !== o,
                        'fa-chevron-up': orcamentoExpandido === o
                      }"
                    ></i>
                  </button>
                </td>
                <td>#{{ o.id }}</td>
                <td>{{ o.destino_id }}</td>
                <td>{{ o.valor_total | currency: 'BRL' }}</td>
                <td>
                  <span
                    class="badge"
                    [ngClass]="{
                      'bg-success': o.status === 'Pagamento Feito',
                      'bg-warning text-dark': o.status === 'Pagamento Pendente',
                      'bg-danger': o.status === 'Recusado'
                    }"
                  >
                    {{ o.status }}
                  </span>
                </td>
              </tr>

              <tr *ngIf="orcamentoExpandido === o">
                <td colspan="6" class="p-0">
                  <div
                    class="detail-container p-3 bg-dark rounded-bottom"
                    @animate.enter
                  >
                    <div *ngIf="o.carregandoContas" class="text-center text-muted py-3">
                      <p>A carregar contas...</p>
                    </div>

                    <div *ngIf="!o.carregandoContas && o.contas && o.contas.length > 0">
                      <h6 class="mb-3 text-white">Contas a Pagar Associadas</h6>
                      <table class="table table-sm table-dark table-borderless text-white-50">
                        <thead>
                          <tr>
                            <th>ID da Conta</th>
                            <th>Valor</th>
                            <th>Vencimento</th>
                            <th>Método</th>
                            <th>Status</th>
                            <th>Ações</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let conta of o.contas">
                            <td>{{ conta.id }}</td>
                            <td>{{ conta.valor | currency: 'BRL' }}</td>
                            <td>{{ conta.dt_vencimento | date: 'dd/MM/yyyy' }}</td>
                            <td>{{ conta.metodo_pagamento }}</td>
                            <td>{{ conta.status }}</td>
                            <td>
                              <button class="btn btn-success btn-sm">
                                <i class="fa-solid fa-money-bill"></i>
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <div
                      *ngIf="!o.carregandoContas && (!o.contas || o.contas.length === 0)"
                      class="text-center text-muted py-3"
                    >
                      <p>Nenhuma conta a pagar encontrada para este orçamento.</p>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>

            <tr *ngIf="orcamentos.length === 0">
              <td colspan="6" class="text-center text-muted py-4">
                Nenhum orçamento encontrado.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
